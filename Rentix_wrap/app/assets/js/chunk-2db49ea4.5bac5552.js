(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2db49ea4"],{"187a":function(t,e,r){},"23f7":function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"repairs"},[r("div",{staticClass:"table__wrap"},[r("div",{staticClass:"caption-wrap"},[r("h2",{staticClass:"repairs__caption"},[t._v("В ремонте")]),r("small",[t._v(" "+t._s(t.currentRepairs.length)+" шт")]),r("button",{on:{click:function(e){return t.newRepair()}}},[t._v("Добавить в ремонт")])]),r("table",{staticClass:"repairs__table"},[t._m(0),t._l(t.currentRepairs.filter(t.filt),function(e){return r("tr",{key:e.id_rent,on:{click:function(r){return t.changeRepair(e)}}},[r("td",{staticClass:"repairs__td col--name"},[t._v(t._s(e.product_name))]),r("td",{staticClass:"repairs__td"},[t._v(t._s(e.repair_type_name))]),r("td",{staticClass:"repairs__td"},[t._v(t._s(e.cost_comp))]),r("td",{staticClass:"repairs__td"},[t._v(t._s(e.cost_work))]),r("td",{staticClass:"repairs__td col--note"},[t._v(t._s(t._f("formNote")(e.note)))]),r("td",{staticClass:"repairs__td col--start"},[t._v(t._s(t._f("shortDate")(e.start_time)))])])})],2)]),"details"===t.show?r("Details",{attrs:{_repair:t.repair},on:{close:function(e){t.show="repairs"}}}):t._e(),"bikeList"===t.show?r("BikesList",{on:{close:function(e){t.show="repairs"},select:function(e){return t.addBikeToNewRepair(e)}}}):t._e()],1)},n=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",[r("th",[t._v("Название")]),r("th",[t._v("Тип")]),r("th",{attrs:{colspan:"2"}},[r("small",[t._v("Стоимости "),r("br"),t._v("компл. и работы")])]),r("th",[t._v("Примечание")]),r("th",[t._v("Начало")])])}],a=(r("7514"),r("7f7f"),r("c060")),s=r("8a88"),o=r("7e70"),c=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"canvas"},[r("div",{staticClass:"details bikelist"},[t._m(0),r("input",{attrs:{placeholder:"Начните вводить название"},on:{input:function(e){return t.search()}}}),t.products&&t.products.length>0?r("table",{staticClass:"bikelist__table"},[t._m(1),t._l(t.products.filter(t.filt),function(e){return r("tr",{key:e.id_rent,on:{click:function(r){return t.select(e)}}},[r("td",[t._v(t._s(e.name))]),r("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t._f("round")(e.mileage))+" ч.")]),r("td",[t._v(t._s(t._f("shortDate")(e.last_repair_time)))])])})],2):t._e(),r("div",{staticClass:"details__close",on:{click:function(e){return t.close()}}})])])},u=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"bikelist__caption"},[r("h3",[r("span",[t._v("Добавить в ремонт")])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",[r("th",[t._v("Название")]),r("th",[t._v("Пробег")]),r("th",[t._v("Дата последнего ремонта")])])}],p={data:function(){return{filt:function(t){return t}}},methods:{search:function(){var t=event.target.value;this.filt=function(e){var r=e?e.name:"";return r.toUpperCase().indexOf(t.toUpperCase())>=0}},close:function(){this.$emit("close")},select:function(t){this.$emit("select",t)}},computed:{products:function(){var t=this,e=function(e){var r=Object(a["a"])(t.$store.getters.repairs),i=r.filter(function(t){return t.product_id==e&&t.end_time}),n=i.reduce(function(t,e){return null===t&&(t=e),Date.parse(e.end_time)>Date.parse(t.end_time)&&(t=e),t},null);return n},r=Object(a["a"])(this.$store.getters.products),i=r.filter(function(t){return"deleted"!==t.status});return i.map(function(t){var r=e(t.id_rent);return t.last_repair_time=r?r.end_time:"",t})}},filters:{round:function(t){return t?Math.round(t):0},shortDate:function(t){return s["a"]("DD MMMM YYYY",t)}}},l=p,_=(r("538b"),r("2877")),d=Object(_["a"])(l,c,u,!1,null,"63d04e11",null),f=d.exports,v={components:{Details:o["a"],BikesList:f},data:function(){return{filt:function(t){return t},repair:{},show:"repairs"}},methods:{changeRepair:function(t){this.repair=t,this.repair.isNew=!1,this.show="details"},newRepair:function(){this.repair={cost_work:0,cost_comp:0,start_time:new Date,repair_type:null},this.repair.isNew=!0,this.repair.isPlan=!1,this.repair.isCompleate=!1,this.show="bikeList"},addBikeToNewRepair:function(t){this.repair.product_id=t.id_rent,this.repair.product_name=t.name,this.show="details"},getProductName:function(t){var e=this.$store.getters.products.find(function(e){return e.id_rent===t});return e?e.name:""},getRepairTypeName:function(t){var e=this.$store.getters.repairTypes.find(function(e){return e.id_rent===t});return e?e.name:""}},computed:{currentRepairs:function(){var t=this,e=this.$store.getters.repairs,r=Object(a["a"])(e.filter(function(t){return!t.end_time}));return r.map(function(e){return e.product_name=t.getProductName(e.product_id),e.repair_type_name=t.getRepairTypeName(e.repair_type),e.mileage=t.$store.getters.products.find(function(t){return t.id_rent===e.product_id}).mileage,e})}},filters:{round:function(t){return t?Math.round(t):0},shortDate:function(t){return s["a"]("DD.MM.YY",t)},formNote:function(t){return t&&t.length>20?t.substr(0,19)+"...":t}}},m=v,h=(r("ab1d"),Object(_["a"])(m,i,n,!1,null,null,null));e["default"]=h.exports},3846:function(t,e,r){r("9e1e")&&"g"!=/./g.flags&&r("86cc").f(RegExp.prototype,"flags",{configurable:!0,get:r("0bfb")})},"538b":function(t,e,r){"use strict";var i=r("fbbf"),n=r.n(i);n.a},"6b54":function(t,e,r){"use strict";r("3846");var i=r("cb7c"),n=r("0bfb"),a=r("9e1e"),s="toString",o=/./[s],c=function(t){r("2aba")(RegExp.prototype,s,t,!0)};r("79e5")(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?c(function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?n.call(t):void 0)}):o.name!=s&&c(function(){return o.call(this)})},"717e":function(t,e,r){"use strict";var i=r("fd48"),n=r.n(i);n.a},"7e70":function(t,e,r){"use strict";var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"canvas"},[r("div",{staticClass:"details details--repair"},[r("h3",[t.repair.isNew?r("span",[t._v("Новый ремонт")]):t._e(),t.repair.isNew?t._e():r("span",[t._v("Детальная информация")])]),r("table",[r("tr",[r("td",[t._v("Товар")]),r("td",[t._v(t._s(t.repair.product_name))])]),r("tr",[r("td",[t._v("Начало ремонта")]),r("td",[r("span",[t._v(t._s(t.short(t.repair.start_time)))])])]),t.repair.end_time?r("tr",[r("td",[t._v("Конец ремонта")]),r("td",[t.repair.end_time?r("span",[t._v(t._s(t.short(t.repair.end_time)))]):t._e()])]):t._e(),r("tr",[t._m(0),r("td",[r("select",{directives:[{name:"model",rawName:"v-model",value:t.repair.repair_type,expression:"repair.repair_type"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.$set(t.repair,"repair_type",e.target.multiple?r:r[0])}}},[r("option",{attrs:{value:"null",disabled:""}},[t._v("Выбрать")]),t._l(t.planTypes,function(e){return r("option",{key:e.id_rent,domProps:{value:e.id_rent}},[t._v(t._s(e.name))])}),r("option",{attrs:{value:"null",disabled:""}},[t._v("__________________________")]),t._l(t.simpleTypes,function(e){return r("option",{key:e.id_rent,domProps:{value:e.id_rent}},[t._v(t._s(e.name))])})],2)])]),r("tr",[r("td",[t._v("Стоимость комплектующих")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.repair.cost_comp,expression:"repair.cost_comp"}],domProps:{value:t.repair.cost_comp},on:{input:function(e){e.target.composing||t.$set(t.repair,"cost_comp",e.target.value)}}})])]),r("tr",[r("td",[t._v("Стоимость работы")]),r("td",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.repair.cost_work,expression:"repair.cost_work"}],domProps:{value:t.repair.cost_work},on:{input:function(e){e.target.composing||t.$set(t.repair,"cost_work",e.target.value)}}})])]),r("tr",[r("td",[t._v("Примечание")]),r("td",[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.repair.note,expression:"repair.note"}],domProps:{value:t.repair.note},on:{input:function(e){e.target.composing||t.$set(t.repair,"note",e.target.value)}}})])])]),r("div",{staticClass:"btn-group"},[r("button",{on:{click:t.save}},[t._v("Сохранить")]),r("button",{on:{click:t.close}},[t._v("Отмена")]),t.repair.isCompleate||t.repair.isNew?t._e():r("button",{on:{click:t.stop}},[t._v("Завершить ремонт")])]),r("div",{staticClass:"details__close",on:{click:t.close}})])])},n=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("td",[t._v("Тип ремонта "),r("span",{attrs:{title:"Обязательно к заполнению"}},[t._v("*")])])}],a=(r("55dd"),r("c060")),s=(r("6b54"),function(t,e){t||(t=(new Date).toString());var r=new Date(t);if(isNaN(r))console.log("date.js, makeDate","error to parse date",{fullDate:t});else{var i=r.getFullYear(),n=+r.getMonth()+1<=9?"0".concat(+r.getMonth()+1):"".concat(+r.getMonth()+1),a=+r.getDate()<=9?"0".concat(+r.getDate()):r.getDate(),s=+r.getHours()<=9?"0".concat(+r.getHours()):r.getHours(),o=+r.getMinutes()<=9?"0".concat(+r.getMinutes()):r.getMinutes();if(i&&n&&a){if(!e||s&&o)return e?"".concat(i,"-").concat(n,"-").concat(a," ").concat(s,":").concat(o):"".concat(i,"-").concat(n,"-").concat(a);console.log("date.js, makeDate","error to parse hourse",{mod:e,hours:s})}else console.log("date.js, makeDate","error to parse date",{year:i,month:n,day:a})}}),o=r("8a88"),c={props:{_repair:Object},data:function(){return{repair:Object(a["a"])(this._repair)}},methods:{close:function(){this.$emit("close")},save:function(){this.isReady()?(this.$store.dispatch("setRepair",this.repair),this.$emit("close")):alert("Укажите необходимые данные!")},stop:function(){this.repair.end_time=new Date,this.$store.dispatch("stopRepair",this.repair),this.$emit("close")},short:function(t){return o["a"]("DD MMMM YYYY",t)},isReady:function(){return!!this.repair.repair_type&&!("other"===this.repair.repair_type&&!this.repair.note)}},computed:{startMin:function(){return s()},repairTypes:function(){var t=this.$store.getters.repairTypes;return t.filter(function(t){return"active"===t.status})},planTypes:function(){return this.repairTypes?this.repairTypes.filter(function(t){return"1"===t.is_plan}):[]},simpleTypes:function(){var t=this.repairTypes?this.repairTypes.filter(function(t){return"0"===t.is_plan}):[],e=t.sort(function(t,e){return e.id_rent-t.id_rent});return e}}},u=c,p=(r("717e"),r("2877")),l=Object(p["a"])(u,i,n,!1,null,"66e175e6",null);e["a"]=l.exports},ab1d:function(t,e,r){"use strict";var i=r("187a"),n=r.n(i);n.a},fbbf:function(t,e,r){},fd48:function(t,e,r){}}]);
//# sourceMappingURL=chunk-2db49ea4.5bac5552.js.map